(function () {

    function byId(id) {
        return document.getElementById(id);
    }

    function init(config) {
        console.log("✅ LmsScorm.init çalıştı");

        const btn = byId("btn-start-scorm");
        const iframe = byId("scorm-iframe");

        if (!btn || !iframe) {
            console.warn("⛔ SCORM DOM hazır değil, init iptal");
            return;
        }

        btn.addEventListener("click", () => {
            // (Normalde backend’den pre-signed URL gelir)
            iframe.src = "/scorm/index.html";
            console.log("▶️ SCORM başlatıldı");
        });

        ["scorm-userId", "scorm-contentId", "scorm-context"]
            .forEach(id => {
                const el = byId(id);
                if (!el) return;
                el.addEventListener("input", () => updatePreview());
            });

        updatePreview();
    }

    function updatePreview() {
        const json = {
            actor: byId("scorm-userId")?.value,
            verb: "launched",
            object: byId("scorm-contentId")?.value,
            context: byId("scorm-context")?.value,
            contentType: "scorm",
            timestamp: new Date().toISOString()
        };

        byId("scorm-json-preview").textContent =
            JSON.stringify(json, null, 2);
    }

    window.LmsScorm = { init };

})();
