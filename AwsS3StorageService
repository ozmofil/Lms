using LmsPoc.Web.Application.Interfaces;
using LmsPoc.Web.Domain.Entities; // ContentType enum için varsayıyorum

[ApiController]
[Route("api/[controller]")]
public class StorageController : ControllerBase
{
    private readonly IStorageService _storageService;

    public StorageController(IStorageService storageService)
    {
        _storageService = storageService;
    }

    // ... mevcut Upload action'ın burada ...

    /// <summary>
    /// Verilen eğitim türüne göre S3 üzerindeki içerikleri listeler.
    /// Örn: /api/storage/list?contentType=Mp4
    /// </summary>
    [HttpGet("list")]
    public async Task<IActionResult> List([FromQuery] string contentType)
    {
        if (!Enum.TryParse<ContentType>(contentType, true, out var type))
            return BadRequest("Geçersiz contentType.");

        // Her tür için S3 prefix'i
        var prefix = type switch
        {
            ContentType.Mp4   => "lms-poc-content/videos/",
            ContentType.Pdf   => "lms-poc-content/pdfs/",
            ContentType.Scorm => "lms-poc-content/scorm/",
            ContentType.Xapi  => "lms-poc-content/xapi/",
            _ => "lms-poc-content/"
        };

        var items = await _storageService.ListAsync(prefix);

        // Basit DTO
        var result = items.Select(x => new
        {
            x.Key,
            x.Url,
            x.ContentType
        });

        return Ok(result);
    }
}
